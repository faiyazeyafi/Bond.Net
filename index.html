<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BondNet ‚Äî Facebook-like Online Demo</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f0f2f5; }
    header { background: #1877f2; color: white; padding: 12px; display: flex; justify-content: space-between; align-items: center; }
    .container { max-width: 800px; margin: 20px auto; padding: 0 12px; }
    .card { background: white; border-radius: 8px; padding: 12px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .btn { background: #1877f2; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
    .btn.secondary { background: #e4e6eb; color: #050505; }
    input, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 8px; }
    .avatar { width: 40px; height: 40px; border-radius: 50%; display: inline-block; background: gray; text-align: center; line-height: 40px; color: white; font-weight: bold; margin-right: 8px; }
    .post-header { display: flex; align-items: center; margin-bottom: 6px; }
    .post-image { max-width: 100%; margin-top: 8px; border-radius: 6px; }
    .actions { margin-top: 8px; display: flex; gap: 8px; }
    .comment { padding: 6px 8px; background: #f7f9fc; border-radius: 6px; margin-top: 4px; }
  </style>
</head>
<body>
<header>
  <h1>BondNet</h1>
  <div id="userStatus">Not signed in</div>
</header>
<main class="container">
  <div id="authCard" class="card">
    <h3>Sign in / Sign up</h3>
    <input type="text" id="nameInput" placeholder="Your name" />
    <input type="password" id="pinInput" placeholder="4-digit PIN" maxlength="4" />
    <input type="file" id="profilePic" accept="image/*" />
    <button class="btn" id="loginBtn">Sign in</button>
  </div>

  <div id="createCard" class="card" style="display:none">
    <h3>Create Post</h3>
    <textarea id="postText" placeholder="What's on your mind?"></textarea>
    <input type="file" id="postImage" accept="image/*" />
    <button class="btn" id="publishBtn">Publish</button>
    <button class="btn secondary" id="logoutBtn">Logout</button>
  </div>

  <div id="feed"></div>
</main>
<script>
const LS_USERS='bondnet_users_v1';
const LS_SESSION='bondnet_session_v1';
const LS_POSTS='bondnet_posts_v1';

function $(id){return document.getElementById(id)}
function uid(len=8){return Math.random().toString(36).substr(2,len)}
function now(){return new Date().toISOString()}
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
function load(k,d){try{return JSON.parse(localStorage.getItem(k))||d}catch{return d}}
function readFile(f){return new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(f);})}

let users=load(LS_USERS,{});
let posts=load(LS_POSTS,[]);
let session=load(LS_SESSION,null);

const userStatus=$('userStatus');
const authCard=$('authCard');
const createCard=$('createCard');
const nameInput=$('nameInput');
const pinInput=$('pinInput');
const profilePic=$('profilePic');
const loginBtn=$('loginBtn');
const logoutBtn=$('logoutBtn');
const postText=$('postText');
const postImage=$('postImage');
const publishBtn=$('publishBtn');
const feed=$('feed');

function renderUI(){
  if(session && users[session]){
    authCard.style.display='none';
    createCard.style.display='block';
    userStatus.innerHTML=`<div class='avatar'><img src='${users[session].avatar||''}' style='width:100%;height:100%;border-radius:50%' onerror='this.style.display="none"'></div>${users[session].name}`;
  }else{
    authCard.style.display='block';
    createCard.style.display='none';
    userStatus.textContent='Not signed in';
  }
  renderFeed();
}

function timeAgo(iso){
  const s=Math.floor((Date.now()-new Date(iso))/1000);
  if(s<60) return s+'s';
  if(s<3600) return Math.floor(s/60)+'m';
  if(s<86400) return Math.floor(s/3600)+'h';
  return new Date(iso).toLocaleString();
}

function renderFeed(){
  feed.innerHTML='';
  if(posts.length===0){feed.innerHTML='<div class="card">No posts yet.</div>';return;}
  posts.slice().reverse().forEach(p=>{
    const card=document.createElement('div'); card.className='card';
    let avatarHTML=`<div class='avatar'><img src='${users[p.user]?.avatar||''}' style='width:100%;height:100%;border-radius:50%' onerror='this.style.display="none"'></div>`;
    let contentHTML=`<div class='post-header'>${avatarHTML}<strong>${users[p.user]?.name||'Unknown'}</strong></div>${p.text}`;
    if(p.image) contentHTML+=`<img src='${p.image}' class='post-image'>`;
    contentHTML+=`<div class='actions'><button onclick='likePost("${p.id}")'>üëç ${p.likes.length}</button><button onclick='toggleComment("${p.id}")'>üí¨ ${p.comments.length}</button></div>`;
    contentHTML+=`<div id='comments-${p.id}' style='display:none'>`;
    p.comments.forEach(c=>{
      contentHTML+=`<div class='comment'><strong>${users[c.user]?.name||'U'}</strong>: ${c.text}</div>`;
    });
    contentHTML+=`<input type='text' placeholder='Comment...' id='input-${p.id}' style='width:80%'/><button onclick='addComment("${p.id}")'>Send</button></div>`;
    card.innerHTML=contentHTML;
    feed.appendChild(card);
  });
}

loginBtn.onclick=async ()=>{
  const name=nameInput.value.trim();
  const pin=pinInput.value.trim();
  if(!name||pin.length!==4)return alert('Enter name and 4-digit PIN');
  let avatar=null;
  if(profilePic.files[0]) avatar=await readFile(profilePic.files[0]);
  let existing=Object.entries(users).find(([id,u])=>u.name.toLowerCase()===name.toLowerCase()&&u.pin===pin);
  if(existing){session=existing[0];if(avatar) users[session].avatar=avatar;}
  else {const id=uid(10);users[id]={id,name,pin,avatar};session=id;}
  save(LS_USERS,users); save(LS_SESSION,session);
  renderUI();
}

logoutBtn.onclick=()=>{if(!confirm('Sign out?'))return;session=null;save(LS_SESSION,session);renderUI();}

publishBtn.onclick=async ()=>{
  if(!session)return alert('Sign in first');
  const text=postText.value.trim();
  if(!text && !postImage.files[0]) return alert('Write something or add image');
  let imgData=null;
  if(postImage.files[0]) imgData=await readFile(postImage.files[0]);
  posts.push({id:uid(10),user:session,text,created:now(),image:imgData,likes:[],comments:[]});
  save(LS_POSTS,posts); postText.value=''; postImage.value=''; renderFeed();
}

function likePost(pid){
  if(!session)return alert('Sign in to like');
  const p=posts.find(p=>p.id===pid); if(!p)return;
  const idx=p.likes.indexOf(session); if(idx===-1)p.likes.push(session);else p.likes.splice(idx,1);
  save(LS_POSTS,posts); renderFeed();
}

function toggleComment(pid){
  const el=$('comments-'+pid);
  if(el) el.style.display=el.style.display==='none'?'block':'none';
}

function addComment(pid){
  const input=$('input-'+pid); if(!input) return;
  const val=input.value.trim(); if(!val) return;
  const p=posts.find(p=>p.id===pid); if(!p) return;
  p.comments.push({user:session,text:val}); input.value=''; save(LS_POSTS,posts); renderFeed();
}

renderUI();
</script>
</body>
</html>
